<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CrowdServe — Notifications</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <link rel="stylesheet" th:href="@{/css/dashboard.css}" href="../static/css/dashboard.css">
  <link rel="stylesheet" th:href="@{/css/navbar.css}" href="../static/css/navbar.css">
  
  <meta name="_csrf" th:content="${_csrf.token}" />
  <meta name="_csrf_header" th:content="${_csrf.headerName}" />

  <style>
    /* --- Modern Notification UI --- */
    :root {
      --primary: #0b6fff;
      --bg-light: #f3f4f6;
      --text-dark: #1f2937;
      --border: #e5e7eb;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-light);
      color: var(--text-dark);
      margin: 0;
    }

    /* Navbar Override */
    .cs-navbar {
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .cs-links a { text-decoration: none; color: #4b5563; margin-left: 1.5rem; font-weight: 500; }
    .cs-links a:hover { color: var(--primary); }
    .cs-cta { background-color: var(--primary); color: white !important; padding: 0.5rem 1rem; border-radius: 6px; }

    /* Layout */
    .page { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .page-title { font-size: 1.875rem; font-weight: 700; margin-bottom: 2rem; }
    
    .layout {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 30px;
    }

    /* Header Section */
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .panel-header h2 { margin: 0; font-size: 1.25rem; }

    /* Buttons */
    .btn-sm { font-size: 0.85rem; padding: 6px 12px; }
    .btn-outline { background: white; border: 1px solid #d1d5db; color: #374151; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
    .btn-outline:hover { background: #f9fafb; border-color: #9ca3af; }
    
    /* Notification Card */
    .notification-list { display: flex; flex-direction: column; gap: 15px; }

    .notification-card {
      padding: 20px;
      border-radius: 10px;
      border: 1px solid var(--border);
      position: relative;
      transition: all 0.2s;
    }

    /* UNREAD State */
    .notification-card.unread {
      background: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      border-left: 4px solid var(--primary);
    }
    
    /* READ State */
    .notification-card.read {
      background: #f9fafb; /* Grayed out */
      border-left: 4px solid #d1d5db;
      opacity: 0.85;
    }

    .notification-body {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 20px;
    }

    .notification-left { flex: 1; }

    .notification-title {
      font-weight: 600;
      color: #111827;
      font-size: 1rem;
      margin-bottom: 5px;
    }
    
    .notification-message {
      color: #4b5563;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .notification-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 10px;
      min-width: 120px;
    }

    .notification-ts {
      font-size: 0.8rem;
      color: #9ca3af;
      white-space: nowrap;
    }

    /* Badge dot for unread */
    .dot {
      height: 10px;
      width: 10px;
      background-color: #ef4444; /* Red dot */
      border-radius: 50%;
      display: inline-block;
      position: absolute;
      top: 20px;
      right: 20px;
      box-shadow: 0 0 0 2px white;
    }

    /* Mark Read Button Hover Effect */
    .mark-read-btn:hover {
      color: var(--primary);
      border-color: var(--primary);
    }

    /* Sidebar */
    .sidebar .card {
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .card-heading { font-weight: 600; margin-bottom: 10px; font-size: 1rem; border-bottom: 1px solid #f3f4f6; padding-bottom: 8px; }
    .small { font-size: 0.9rem; color: #6b7280; line-height: 1.5; }
    .link-primary { color: var(--primary); text-decoration: none; }
    .link-primary:hover { text-decoration: underline; }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 50px;
      background: white;
      border-radius: 12px;
      border: 2px dashed #e5e7eb;
      color: #6b7280;
    }
  </style>
</head>
<body>

  <nav class="cs-navbar" role="navigation" aria-label="Main navigation" style="padding:18px 32px; font-size:15px;">
    <style>
      .nav-link { color: #4b5563; padding: 8px 12px; border-radius: 10px; font-weight: 600; text-decoration: none; transition: background 0.2s, color 0.2s; }
      .nav-link:hover { color: #0b6fff; background: rgba(11,111,255,0.08); }
      .nav-active { color: #0b6fff !important; background: rgba(11,111,255,0.12); font-weight: 700; }
      .cs-cta { background: #0b6fff; color: #fff !important; padding: 10px 16px; border-radius: 10px; font-weight: 700; }
    </style>
    <div class="cs-brand" style="display:flex; align-items:center; gap:8px;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true" style="width:24px; height:24px;">
        <circle cx="12" cy="12" r="3" stroke="#0b6fff" fill="#eaf3ff" />
        <path d="M3 12h18" stroke="#0b6fff" />
      </svg>
      <span class="brand-text" style="font-weight:700; font-size:1.2rem; color:#0b6fff;">CrowdServe</span>
    </div>
    <button class="cs-toggle" aria-expanded="false" aria-label="Toggle navigation" style="border:none; background:none; font-size:1.5rem;">☰</button>
    <div class="cs-links" style="display:flex; align-items:center; gap:18px;">
        <a th:href="@{/}" href="/" class="nav-link" th:classappend="${activePage} == 'home' ? ' nav-active' : ''">Home</a>
        <a th:href="@{/dashboard}" href="/dashboard" class="nav-link" th:classappend="${activePage} == 'dashboard' ? ' nav-active' : ''">Dashboard</a>
        <a th:href="@{/my-tasks}" href="/my-tasks" class="nav-link" th:classappend="${activePage} == 'my-tasks' ? ' nav-active' : ''">My Tasks</a>
        <a th:href="@{/notifications}" href="/notifications" class="nav-link" th:classappend="${activePage} == 'notifications' ? ' nav-active' : ''">Notifications</a>
        <a th:href="@{/reports}" href="/reports" class="nav-link" th:classappend="${activePage} == 'reports' ? ' nav-active' : ''">Reports</a>
        <a th:href="@{/profile}" href="/profile" class="nav-link" th:classappend="${activePage} == 'profile' ? ' nav-active' : ''" sec:authorize="isAuthenticated()">Profile</a>
        <a th:href="@{/login}" href="/login" class="nav-link" th:classappend="${activePage} == 'login' ? ' nav-active' : ''" sec:authorize="!isAuthenticated()">Login</a>
        <a th:href="@{/register}" href="/register" class="cs-cta nav-link" th:classappend="${activePage} == 'register' ? ' nav-active' : ''" sec:authorize="!isAuthenticated()">Register</a>
    </div>
  </nav>

  <script>
    (function(){
      var btn = document.querySelector('.cs-toggle');
      var links = document.querySelector('.cs-links');
      if(!btn || !links) return;
      btn.addEventListener('click', function(){
        var open = links.classList.toggle('open');
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    })();
  </script>

  <div class="page">
    <h1 class="page-title">Notifications</h1>

    <div class="layout">
      <main>
        
        <div class="panel">
          <div class="panel-header">
             <h2>Your Notifications</h2>
             
             <button id="mark-all-read-btn"
                     class="btn btn-outline btn-sm"
                     th:attr="data-has-unread=${!#lists.isEmpty(unreadNotifications)}"
                     th:disabled="${#lists.isEmpty(unreadNotifications)}">
               <i class="fa-solid fa-check-double"></i> Mark all as read
             </button>
          </div>

          <div th:if="${#lists.isEmpty(unreadNotifications) and #lists.isEmpty(readNotifications)}" class="empty-state">
            <div style="font-size: 2rem; color: #d1d5db; margin-bottom: 10px;">
              <i class="fa-regular fa-bell-slash"></i>
            </div>
            You're all caught up! No notifications yet.
          </div>

          <div th:if="${!#lists.isEmpty(unreadNotifications)}">
            <h3 style="margin: 0 0 12px 0;">New</h3>
            <div class="notification-list" id="unread-list">
              <div th:each="notification : ${unreadNotifications}" 
                   th:class="'notification-card unread'"
                   th:attr="data-id=${notification.id}">

                <div class="notification-body">
                  
                  <div class="notification-left">
                    <div class="notification-title">
                       <i class="fa-solid fa-circle-info" style="color:#0b6fff; margin-right:5px; font-size:0.9rem;"></i>
                       <span th:text="${notification.title}">Notification title</span>
                    </div>
                    <div class="notification-message" th:text="${notification.message}">
                      A short message describing the notification.
                    </div>
                  </div>

                  <div class="notification-right">
                    <div class="notification-ts">
                       <i class="fa-regular fa-clock"></i> 
                       <span th:text="${#temporals.format(notification.createdAt, 'MMM d, HH:mm')}">Apr 1, 12:00</span>
                    </div>

                    <button type="button" class="btn btn-outline btn-sm mark-read-btn" 
                            th:attr="data-id=${notification.id}"
                            title="Mark as Read">
                        <i class="fa-solid fa-check"></i> Mark Read
                    </button>

                    <noscript>
                      <form th:action="@{|/notifications/read/${notification.id}|}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <button type="submit" class="btn btn-outline btn-sm">Mark read</button>
                      </form>
                    </noscript>
                  </div>
                </div>

              </div>
            </div>
          </div>

          <div th:if="${#lists.isEmpty(unreadNotifications)}" style="margin: 10px 0 20px; color:#6b7280;">
            No new notifications.
          </div>

          <div style="margin-top: 24px;">
            <h3 style="margin: 0 0 12px 0;">Read</h3>
            <div class="notification-list" id="read-list" th:if="${!#lists.isEmpty(readNotifications)}">
              <div th:each="notification : ${readNotifications}" 
                   class="notification-card read"
                   th:attr="data-id=${notification.id}">

                <div class="notification-body">
                  
                  <div class="notification-left">
                    <div class="notification-title">
                       <i class="fa-solid fa-circle-info" style="color:#9ca3af; margin-right:5px; font-size:0.9rem;"></i>
                       <span th:text="${notification.title}">Notification title</span>
                    </div>
                    <div class="notification-message" th:text="${notification.message}">
                      A short message describing the notification.
                    </div>
                  </div>

                  <div class="notification-right">
                    <div class="notification-ts">
                       <i class="fa-regular fa-clock"></i> 
                       <span th:text="${#temporals.format(notification.createdAt, 'MMM d, HH:mm')}">Apr 1, 12:00</span>
                    </div>
                  </div>
                </div>

              </div>
            </div>

            <div th:if="${#lists.isEmpty(readNotifications)}" class="small" style="color:#9ca3af;">
              Nothing here yet. Mark notifications read to keep an archive.
            </div>
          </div>

        </div>
      </main>

      <aside class="sidebar">
        <div class="card">
          <div class="card-heading"><i class="fa-solid fa-bell"></i> About Notifications</div>
          <div class="small">Notifications keep you informed about task updates, assignments, and payments.</div>
        </div>

        <div class="card">
          <div class="card-heading"><i class="fa-solid fa-filter"></i> Tips</div>
          <div class="small">Mark notifications as read to keep your list clean. Use the "Mark all" button to clear everything at once.</div>
        </div>

        <div class="card">
          <div class="card-heading"><i class="fa-solid fa-circle-question"></i> Help</div>
          <div class="small">Need help? <a th:href="@{/support}" class="link-primary">Contact support</a>.</div>
        </div>
      </aside>
    </div>
  </div>
</body>

<script th:src="@{/js/notifications.js}" src="/static/js/notifications.js"></script>

</html>